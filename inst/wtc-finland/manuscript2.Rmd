---
title: "Manuscript"
output: html_document
---

```{r initialize}
#library(devtools); install_github("statguy/Winter-Track-Counts")
library(parallel)
library(doMC)
registerDoMC(cores=detectCores())
library(WTC)
source("~/git/Winter-Track-Counts/setup/WTC-Boot.R")
library(ggplot2)
library(scales)
library(grid)
library(plyr)

context <- Context$new(resultDataDirectory=wd.data.results, processedDataDirectory=wd.data.processed, rawDataDirectory=wd.data.raw, scratchDirectory=wd.scratch, figuresDirectory=wd.figures)
boundaryDF <- ggplot2::fortify(FinlandWTCStudy(context=context, response="canis.lupus")$studyArea$boundary)
study <- FinlandWTCStudy$new(context=context, response="canis.lupus")
#study$studyArea$loadBoundary(thin=F, tolerance=0.001)
```

```{r figure-convolution-example}
r <- crop(study$studyArea$habitat, extent(3400000, 3410000, 7000000, 7010000))
plot(r)
forest <- calc(r, function(x) if (is.na(x) || x %in% c(0,45:255)) NA else x %in% 18:35)
plot(forest)
coords <- expand.grid(1:dim(r)[1], 1:dim(r)[2])
x <- smoothSubsets(r=forest, coords=coords, kernelFun=expKernel, scales=c(125, 1000), .parallel=T)
plot(flip(rasterFromXYZ(x[,c("x","y","value")]), direction="y"), asp=1)
```
